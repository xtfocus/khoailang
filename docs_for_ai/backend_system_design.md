# **Backend System Design**

## **Overview**
The backend system is built using FastAPI and PostgreSQL, following a modular architecture with clear separation of concerns. The system currently implements user authentication with JWT tokens and is designed to be scalable for future features.

## **Technology Stack**
- **Framework**: FastAPI
- **Database**: PostgreSQL
- **ORM**: SQLAlchemy
- **Authentication**: JWT (JSON Web Tokens)
- **Password Hashing**: Bcrypt
- **Container Platform**: Docker

## **Project Structure**
```
backend/
├── app/
│   ├── database.py          # Database configuration and session management
│   ├── init_db.py          # Database initialization script
│   ├── main.py             # Application entry point
│   ├── dependencies/       # Reusable dependencies
│   │   └── auth.py        # Authentication utilities
│   ├── models/            # SQLAlchemy models
│   │   └── user.py        # User model
│   ├── routes/            # API endpoints
│   │   └── auth.py        # Authentication routes
│   └── schemas/           # Pydantic models
│       └── user.py        # User request/response schemas
```

## **Key Components**

### **1. Database Configuration (database.py)**
- Manages database connection using SQLAlchemy
- Provides session management
- Configurable through environment variables

### **2. Authentication System (dependencies/auth.py)**
- JWT-based authentication
- Password hashing using bcrypt
- Token generation and validation
- User authentication middleware

### **3. Models**
#### User Model (models/user.py)
```python
class User:
    id: Integer
    email: String (unique)
    username: String (unique)
    hashed_password: String
    created_at: DateTime
    updated_at: DateTime
```

### **4. Schemas**
#### User Schemas (schemas/user.py)
- **UserBase**: Base user information
- **UserCreate**: User registration data
- **UserLogin**: Login credentials
- **UserResponse**: User data response
- **Token**: JWT token response

### **5. API Routes**
#### Authentication Routes (routes/auth.py)
- **POST /auth/signup**: User registration
  - Validates unique email and username
  - Hashes password
  - Creates new user record
  
- **POST /auth/login**: User authentication
  - Validates credentials
  - Issues JWT token
  
- **GET /auth/me**: Get current user
  - Requires valid JWT token
  - Returns user information

## **Security Features**
1. **Password Security**
   - Passwords are hashed using bcrypt
   - Original passwords are never stored
   
2. **JWT Authentication**
   - Tokens expire after 30 minutes
   - Secured with a secret key
   - Bearer token authentication

3. **Input Validation**
   - Email format validation
   - Username uniqueness check
   - Password requirements enforcement

## **Environment Variables**
```env
DATABASE_URL=postgresql://postgres:password@db:5432/cerego
```

## **Docker Integration**
The backend service is containerized with:
- Python base image
- PostgreSQL database connection
- Volume mounting for development
- Hot reload support

## **Future Considerations**
1. **Rate Limiting**
   - Implement request rate limiting
   - Add API usage monitoring

2. **Refresh Tokens**
   - Add refresh token support
   - Implement token rotation

3. **Password Reset**
   - Implement password reset flow
   - Add email verification

4. **Authorization**
   - Role-based access control
   - Permission management

5. **Logging**
   - Add structured logging
   - Implement audit trails

## **API Documentation**
The API documentation is automatically generated by FastAPI and available at:
- Swagger UI: `http://localhost:8000/docs`
- ReDoc: `http://localhost:8000/redoc`